# Test Site (Do not delete)
name: Transcript Audio VOT

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  transcribe:
    runs-on: ubuntu-latest
    continue-on-error: true

    steps:
      # 1️⃣ Clone repo tanpa dotfiles
      - name: Clone Whisper-CPP dan keluarkan isinya ke ../
        run: |
          git clone https://github.com/Sparkplugx1904/Whisper-CPP.git temp_whisper
          cd temp_whisper
          shopt -s extglob
          mv !(.?*) ../
          cd ..
          rm -rf temp_whisper

      # 2️⃣ Setup FFmpeg
      - name: Setup FFmpeg
        uses: FedericoCarboni/setup-ffmpeg@v3

      # 2️⃣ Setup FFmpeg
      - name: Setup FFmpeg
        uses: FedericoCarboni/setup-ffmpeg@v3

      # 2️⃣ Setup FFmpeg
      - name: Setup FFmpeg
        uses: FedericoCarboni/setup-ffmpeg@v3

      # 3️⃣ Install dependencies
      - name: Install Python dependencies
        run: |
          pip install requests pydub 

      # 4️⃣ Transcribe audio
      - name: Run transcriptor CPP
        run: |
          # python3 -u transcriptor_cpp.py "https://github.com/Sparkplugx1904/voiceoftrisma/raw/refs/heads/main/assets/sample_vot.mp3" -m medium
          # python3 -u transcriptor_cpp.py "https://archive.org/download/vot-denpasar-20251122-183000/VOT-Denpasar_22-11-25-0.mp3" -m medium
          python3 -u transcriptor_cpp.py "https://archive.org/download/vot-denpasar-20251122-183000/VOT-Denpasar_22-11-25-0.mp3" -cm "https://storage.googleapis.com/kaggle-script-versions/281305239/output/whisper-medium-id/ggml-model-f32.bin?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=gcp-kaggle-com%40kaggle-161607.iam.gserviceaccount.com%2F20251124%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20251124T010740Z&X-Goog-Expires=3600&X-Goog-SignedHeaders=host&X-Goog-Signature=4dc1e5596f1f7b12c8b19db9bf249b5ba9cfce4c059faac52c3fad0da03a74c8e60361eda03d37867c6a5f4fe014eb5394e1003fa234cb5f9f2e6a669ee192111c70d0aa7d4cf00b6b2171f501e329f58d9694243a90b04ef3c924e636e035676a3d59ec72a5c8a3e8eb41eb5cd49644a6e71eb3fa693ea5f7243f902c92080800bc318b1c5cf4c0991c0b43272216f754fc22593c16e934c64e906516e445112048b580441b0c6ea4c46715fdee72a3640983681b0504161fb376435df680bd81c6aa92f4227b7461ca7f4985deb222e2d1670683a0805dc227ef0b7f8ff55824de10af3883622b3e99fc0920390968198733c2a7028901b038e5d6f637b864"

      # 5️⃣ Upload hasil transkrip sebagai artifact
      - name: Upload transcript artifact
        uses: actions/upload-artifact@v4
        with:
          name: vot-transcript
          path: transcripts/
          retention-days: 1
